Implement the following plan:

# Post-Deploy: Logos, Watermark, 3D Axes, Button Layout, Banner, Word Count

## Context

Six issues visible post-deployment need fixes: title page logos crash if file missing, sandbox watermark is ugly instead of branded, 3D scatter axes clip the container, editor buttons shift when messages appear, licence banner has poor contrast, and word count includes BibTeX trailer.

---

## Change 1: Logo Fallback in CLS Files

**Files**: `templates/sskm-thesis.cls` (lines 349-351), `templates/ssuhs-thesis.cls` (lines 382-389), `apps/web/lib/latex/generate-tex.ts` (line 54-58)

**Problem**: If logo path is set but file doesn't exist on disk, `\includegraphics` crashes compilation.

**Fix in both CLS files** — add a safe helper after the setter commands (~line 210/226):
```latex
\newcommand{\@includelogoifexists}[2]{%
  \IfFileExists{#1.pdf}{\includegraphics[width=#2]{#1}\\[0.4cm]}{%
  \IfFileExists{#1.png}{\includegraphics[width=#2]{#1}\\[0.4cm]}{%
  \IfFileExists{#1.jpg}{\includegraphics[width=#2]{#1}\\[0.4cm]}{}}}%
}
```

Replace `\includegraphics` calls in title page:
- `sskm-thesis.cls:350` → `\@includelogoifexists{\universitylogopath}{4.5cm}`
- `ssuhs-thesis.cls:383` → `\@includelogoifexists{\universitylogopath}{4.5cm}`
- `ssuhs-thesis.cls:388` → `\@includelogoifexists{\institutelogopath}{3.5cm}`

**`generate-tex.ts`**: Add `generic` entry with empty logo paths:
```typescript
generic: { university: "", institute: "" },
```

---

## Change 2: Branded Sandbox Watermark

**File**: `apps/web/lib/latex/compile.ts` (lines 264-283, `injectWatermarkPackage`)

**Problem**: Current sandbox watermark is "SANDBOX --- Apollo" in default font at 45° — looks like a warning, not branding. User wants elegant "Apollo" as stealth marketing.

**Fix**: Use Palatino (`ppl`) — closest TeX Live serif to Playfair Display:

```typescript
function injectWatermarkPackage(
  texContent: string,
  options: { watermark?: boolean; draftFooter?: boolean }
): string {
  if (!options.watermark && !options.draftFooter) return texContent;
  const beginDocIdx = texContent.indexOf("\\begin{document}");
  if (beginDocIdx === -1) return texContent;

  let pkg: string;
  if (options.watermark) {
    // Sandbox: elegant centered "Apollo" in Palatino italic — stealth branding
    pkg = [
      "\\usepackage{draftwatermark}",
      "\\SetWatermarkText{\\fontfamily{ppl}\\selectfont\\itshape Apollo}",
      "\\SetWatermarkColor[gray]{0.92}",
      "\\SetWatermarkScale{2.5}",
      "\\SetWatermarkAngle{0}",
    ].join("\n") + "\n";
  } else {
    // Licensed draft: subtle bottom footer
    pkg = [
      "\\usepackage{draftwatermark}",
      "\\SetWatermarkText{\\fontfamily{ppl}\\selectfont Generated with Apollo}",
      "\\SetWatermarkColor[gray]{0.88}",
      "\\SetWatermarkScale{0.3}",
      "\\SetWatermarkAngle{0}",
    ].join("\n") + "\n";
  }
  return texContent.slice(0, beginDocIdx) + pkg + texContent.slice(beginDocIdx);
}
```

---

## Change 3: 3D Scatter Plot Axis Proportions

**File**: `apps/web/components/landing/hero-3d-scene.tsx` (LOCKED — user approved this change)

**Problem**: Z-axis hardcoded to 0.6 (data goes to z=1.30). X-axis at 2.2 clips container at 45° rotation.

**Fix**: Replace single `AXIS_LENGTH` with per-axis constants:
```typescript
const AXIS_LENGTH_X = 1.8;  // Shorter — prevents clipping
const AXIS_LENGTH_Y = 2.2;  // Unchanged
const AXIS_LENGTH_Z = 1.2;  // Doubled — shows full depth
```

Update 9 locations:
- **Tick loops** (lines 371, 374, 377): X→`AXIS_LENGTH_X`, Y→`AXIS_LENGTH_Y`, Z→`AXIS_LENGTH_Z`
- **Axis lines** (lines 394-396): endpoints use respective constants
- **Arrowheads** (lines 399-401): positions use respective constants

---

## Change 4: Stable Button Layout + Auto-Dismissing Messages

**Files**: `compile-button.tsx`, `ai-generate-button.tsx`, `project-workspace.tsx`

**Problem**: CompileButton and AIGenerateButton each stack button + status messages vertically (`space-y-2/3`) inside the action bar's horizontal flex. Messages appearing grow the stack, shifting sibling buttons and word count bar.

**Fix**: Lift message rendering out of button components into a dedicated **status row ABOVE the button row**. Messages auto-dismiss after 8 seconds (success) or are dismissable via click (errors).

### 4A: `compile-button.tsx`
- Add optional `onResult?: (r: CompileResult | null) => void` and `onError?: (e: string | null) => void` callback props
- Call these when result/error state changes (in `handleCompile` and poll handler)
- Remove the `{result && ...}` and `{error && ...}` JSX blocks from return
- Keep only the button + queue badge inline (the `<div className="flex items-center gap-2">` wrapper stays, the outer `<div className="space-y-2">` goes)

### 4B: `ai-generate-button.tsx`
- Add optional `onError?: (e: string | null) => void` callback prop
- Call it when error state changes
- Remove `{error && <p>...}` from return JSX
- Keep citation summary badge (it's contextually tied to the generate action)

### 4C: `project-workspace.tsx` (lines 393-442)

Add state + auto-dismiss logic:
```typescript
const [compileResult, setCompileResult] = useState<CompileResult | null>(null);
const [compileError, setCompileError] = useState<string | null>(null);
const [generateError, setGenerateError] = useState<string | null>(null);

// Auto-dismiss success messages after 8s
useEffect(() => {
  if (!compileResult) return;
  const t = setTimeout(() => setCompileResult(null), 8000);
  return () => clearTimeout(t);
}, [compileResult]);
```

Restructure layout — messages ABOVE buttons:
```tsx
{/* Status messages — above button row, auto-dismiss / click-dismiss */}
{(compileResult || compileError || generateError) && (
  <div className="space-y-1">
    {compileResult && (
      <div
        className="flex items-center justify-between rounded-2xl bg-[#8B9D77]/10 p-3 text-sm text-[#8B9D77] cursor-pointer"
        onClick={() => setCompileResult(null)}
        title="Click to dismiss"
      >
        <span>
          Compiled successfully in {compileResult.compile_time_ms}ms
          {compileResult.warnings.length > 0 && ` (${compileResult.warnings.length} warnings)`}
        </span>
        <X className="h-3.5 w-3.5 opacity-50" />
      </div>
    )}
    {compileError && (
      <div
        className="flex items-center justify-between rounded-2xl bg-destructive/10 p-3 text-sm text-destructive cursor-pointer"
        onClick={() => setCompileError(null)}
        title="Click to dismiss"
      >
        <span>{compileError}</span>
        <X className="h-3.5 w-3.5 opacity-50" />
      </div>
    )}
    {generateError && (
      <div
        className="flex items-center justify-between rounded-2xl bg-destructive/10 p-3 text-sm text-destructive cursor-pointer"
        onClick={() => setGenerateError(null)}
        title="Click to dismiss"
      >
        <span>{generateError}</span>
        <X className="h-3.5 w-3.5 opacity-50" />
      </div>
    )}
  </div>
)}

{/* Action buttons — stable row, never shifts */}
<div className="flex items-center gap-3" data-tour="compile">
  {/* AIGenerateButton, Approve, CompileButton, ExportMenu */}
</div>
```

---

## Change 5: Licence Banner Contrast

**File**: `apps/web/components/project/licence-banner.tsx` (lines 24-42)

**Problem**: `#D4A373` text on `#D4A373/10` bg — very low contrast on `#FAFAFA` dot-grid dashboard background.

**Fix**:
- Background: `bg-[#D4A373]/10` → `bg-[#FDF6EE]` (solid warm cream)
- Border: `border-[#D4A373]/30` → `border-[#C8964C]/40` (slightly richer)
- Heading: `text-[#D4A373]` → `text-[#92600A]` (dark amber — high contrast)
- Body: `text-[#D4A373]/80` → `text-[#7A5F2A]` (dark warm brown)

---

## Change 6: Word Count Excludes BibTeX

**File**: `apps/web/app/api/projects/[id]/sections/[phase]/route.ts` (lines 172-180)

**Problem**: `countWords()` receives full `latex_content` including `---BIBTEX---` trailer. BibTeX entries inflate count (5,200 shown vs ~1,400 body-only).

**Fix**: Split at separator before counting:
```typescript
function countWords(latex: string): number {
  // Only count body — exclude BibTeX trailer
  const sepIdx = latex.indexOf("---BIBTEX---");
  const body = sepIdx >= 0 ? latex.slice(0, sepIdx) : latex;

  const stripped = body
    .replace(/\\[a-zA-Z]+(\{[^}]*\})?/g, " ")
    .replace(/[{}\\%$&_^~#]/g, " ")
    .replace(/\s+/g, " ")
    .trim();
  return stripped ? stripped.split(" ").length : 0;
}
```

---

## Implementation Order

| Step | Change | Files | Complexity |
|------|--------|-------|-----------|
| 1 | Word count fix | `route.ts` | Trivial |
| 2 | Licence banner contrast | `licence-banner.tsx` | Trivial |
| 3 | 3D axis proportions | `hero-3d-scene.tsx` | Small |
| 4 | Watermark branding | `compile.ts` | Small |
| 5 | Logo fallback | `sskm-thesis.cls`, `ssuhs-thesis.cls`, `generate-tex.ts` | Medium |
| 6 | Button layout stability | `compile-button.tsx`, `ai-generate-button.tsx`, `project-workspace.tsx` | Medium |

## Verification

1. **TypeScript**: `npx tsc --noEmit` — 0 errors
2. **Word count**: Section with BibTeX → word_count reflects body only (should drop from ~5,200 to ~1,400 for Introduction)
3. **Banner**: Heading and body text clearly readable against dashboard background
4. **3D scene**: Z-axis visibly longer, X-axis no longer clips container edge
5. **Watermark**: Sandbox compile → "Apollo" in elegant centred Palatino italic, very light grey
6. **Logos**: `generic` university → no logos, no crash. SSKM/SSUHS → logos show if files exist
7. **Buttons**: Compile success → message appears below button row, buttons don't shift


If you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /Users/devs/.REDACTED.jsonl

---

commit , push and watch the CI

---

what is the cause of this onom ci failure and how to fix? will it cause any issues with the deployment?

---

yes

---

./components/project/ai-generate-button.tsx
43:10  Warning: 'bgError' is assigned a value but never used.  @typescript-eslint/no-unused-vars

./components/project/compile-button.tsx
24:10  Warning: 'result' is assigned a value but never used.  @typescript-eslint/no-unused-vars
25:10  Warning: 'error' is assigned a value but never used.  @typescript-eslint/no-unused-vars
79:6  Warning: React Hook useEffect has missing dependencies: 'onError' and 'onResult'. Either include them or remove the dependency array. If 'onResult' changes too often, find the parent component that defines it and wrap that definition in useCallback.  react-hooks/exhaustive-deps

./lib/latex/compile.ts
3:52  Warning: 'access' is defined but never used.  @typescript-eslint/no-unused-vars

---

This session is being continued from a previous conversation that ran out of context. The summary below covers the earlier portion of the conversation.

Analysis:
Let me chronologically analyze the conversation:

1. **Initial Request**: User asked to implement a 6-change plan for post-deploy fixes: logos, watermark, 3D axes, button layout, banner, word count.

2. **Implementation Phase**: I read all 10 files that needed modification, then implemented all 6 changes:
   - Change 1: Word count excluding BibTeX trailer in route.ts
   - Change 2: Licence banner contrast improvements
   - Change 3: 3D scatter plot axis proportions (per-axis constants)
   - Change 4: Branded sandbox watermark (Palatino italic "Apollo")
   - Change 5: Logo fallback in CLS files + generic entry in generate-tex.ts
   - Change 6: Stable button layout (lifting messages to project-workspace.tsx)

3. **First commit/push**: User asked to commit, push, and watch CI. CI failed with `ERR_PNPM_NO_LOCKFILE`.

4. **CI Investigation**: User asked about the CI failure cause. I found:
   - `pnpm-lock.yaml` was at `apps/web/` (pre-workspace leftover) but pnpm workspace expects it at repo root
   - CI pinned pnpm v9 while local uses v10 (incompatible lockfile formats)
   - Fixed by moving lockfile to root and updating CI config

5. **Second CI run**: Lockfile issue fixed, but unit tests failed on `assemble.test.ts:711` (appendices injection test).

6. **User asked to fix the test failure**: I investigated and found the root cause in `sanitise-latex.ts` - the markdown italic regex `(?<!\*)\*([^*]+)\*(?!\*)` was matching `\section*{...}...\section*{...}` as a single italic span, destroying content between starred LaTeX commands. Fixed by changing to `(?<![a-zA-Z*])\*([^*\n]+)\*(?!\*)`.

7. **Third CI run**: All 4 jobs passed (Lint, Unit Tests, Security, Compile).

8. **Current user message**: User posted lint warnings about unused variables and missing hook dependencies, AND asked for a conversation summary. The lint warnings are:
   - `bgError` unused in ai-generate-button.tsx
   - `result` and `error` unused in compile-button.tsx
   - Missing deps in useEffect in compile-button.tsx
   - `access` unused import in compile.ts

The user's most recent message includes lint warnings that need fixing, plus a request for a summary. The lint warnings came from our changes - when we removed the inline error/result JSX from compile-button.tsx and ai-generate-button.tsx, we left the local state variables that are no longer used in rendering. We also have a useEffect with missing dependencies.

Let me trace through the specific issues:

1. `bgError` in ai-generate-button.tsx - we removed the `{error && <p>...}` JSX but `bgError` is still set by `setBgError()`. The combined `error` variable was removed. `bgError` is used in `setBgError(msg)` calls but never read for rendering. We could remove it entirely since errors are forwarded via `onErrorCallback`.

2. `result` and `error` in compile-button.tsx - same issue, we removed the JSX that displayed them but kept the state. They're set but never read for rendering. Could remove them since everything is forwarded via callbacks.

3. Missing deps `onError` and `onResult` in useEffect for compile-button.tsx line 79 - this is the polling useEffect. We added `onResult?.()` and `onError?.()` calls inside but didn't add them to the dependency array.

4. `access` import in compile.ts - this was already unused before our changes (we didn't add or remove imports from compile.ts).

The pending task is to fix these lint warnings.

Summary:
1. Primary Request and Intent:
   The user asked to implement a 6-change plan for post-deploy fixes covering: title page logo crash fallback, branded sandbox watermark, 3D scatter axes proportions, stable button layout with auto-dismissing messages, licence banner contrast, and word count excluding BibTeX trailer. After implementation, the user asked to commit, push, and watch CI. When CI failed, the user asked to diagnose and fix the CI failure, then fix a pre-existing test failure that was revealed once CI could run. The final message shows lint warnings from the changes that still need fixing.

2. Key Technical Concepts:
   - pnpm workspace monorepo structure (lockfile must be at root, not in subdirectory)
   - pnpm v9 vs v10 lockfile format incompatibility
   - LaTeX `\IfFileExists` for graceful logo fallback
   - LaTeX `draftwatermark` package with Palatino font family (`ppl`)
   - React state lifting pattern (moving status messages from child to parent component)
   - Auto-dismiss with `useEffect` + `setTimeout`
   - Regex negative lookbehind for protecting LaTeX starred commands from markdown italic conversion
   - `---BIBTEX---` separator convention for splitting body from BibTeX trailer

3. Files and Code Sections:

   - **`apps/web/app/api/projects/[id]/sections/[phase]/route.ts`** (lines 172-183)
     - Word count function — splits at `---BIBTEX---` before counting
     ```typescript
     function countWords(latex: string): number {
       const sepIdx = latex.indexOf("---BIBTEX---");
       const body = sepIdx >= 0 ? latex.slice(0, sepIdx) : latex;
       const stripped = body
         .replace(/\\[a-zA-Z]+(\{[^}]*\})?/g, " ")
         .replace(/[{}\\%<summary>
1. Primary Request and Intent:
   The user asked to implement a 6-change plan for post-deploy fixes covering: title page logo crash fallback, branded sandbox watermark, 3D scatter axes proportions, stable button layout with auto-dismissing messages, licence banner contrast, and word count excluding BibTeX trailer. After implementation, the user asked to commit, push, and watch CI. When CI failed, the user asked to diagnose and fix the CI failure, then fix a pre-existing test failure that was revealed once CI could run. The final message shows lint warnings from the changes that still need fixing.

2. Key Technical Concepts:
   - pnpm workspace monorepo structure (lockfile must be at root, not in subdirectory)
   - pnpm v9 vs v10 lockfile format incompatibility
   - LaTeX `\IfFileExists` for graceful logo fallback
   - LaTeX `draftwatermark` package with Palatino font family (`ppl`)
   - React state lifting pattern (moving status messages from child to parent component)
   - Auto-dismiss with `useEffect` + `setTimeout`
   - Regex negative lookbehind for protecting LaTeX starred commands from markdown italic conversion
   - `---BIBTEX---` separator convention for splitting body from BibTeX trailer

3. Files and Code Sections:

   - **`apps/web/app/api/projects/[id]/sections/[phase]/route.ts`** (lines 172-183)
     - Word count function — splits at `---BIBTEX---` before counting
     ```typescript
     function countWords(latex: string): number {
       const sepIdx = latex.indexOf("---BIBTEX---");
       const body = sepIdx >= 0 ? latex.slice(0, sepIdx) : latex;
       const stripped = body
         .replace(/\\[a-zA-Z]+(\{[^}]*\})?/g, " ")
         .replace(/[{}\\%$&_^~#]/g, " ")
         .replace(/\s+/g, " ")
         .trim();
       return stripped ? stripped.split(" ").length : 0;
     }
     ```

   - **`apps/web/components/project/licence-banner.tsx`** (lines 24-42)
     - Improved contrast: `bg-[#FDF6EE]`, `border-[#C8964C]/40`, heading `text-[#92600A]`, body `text-[#7A5F2A]`

   - **`apps/web/components/landing/hero-3d-scene.tsx`** (lines 343-401)
     - LOCKED file (user approved change). Replaced single `AXIS_LENGTH=2.2` with per-axis: `AXIS_LENGTH_X=1.8`, `AXIS_LENGTH_Y=2.2`, `AXIS_LENGTH_Z=1.2`. Updated tick loops, axis lines, and arrowheads.

   - **`apps/web/lib/latex/compile.ts`** (lines 264-294)
     - `injectWatermarkPackage()` rewritten: sandbox uses Palatino italic "Apollo" centered at scale 2.5; draft uses "Generated with Apollo" at scale 0.3. Both at angle 0.
     - **LINT WARNING**: `access` import on line 3 is unused (pre-existing, not from our changes)

   - **`templates/sskm-thesis.cls`** and **`templates/ssuhs-thesis.cls`**
     - Added `\@includelogoifexists` helper after logo setter commands:
     ```latex
     \newcommand{\@includelogoifexists}[2]{%
       \IfFileExists{#1.pdf}{\includegraphics[width=#2]{#1}\\[0.4cm]}{%
       \IfFileExists{#1.png}{\includegraphics[width=#2]{#1}\\[0.4cm]}{%
       \IfFileExists{#1.jpg}{\includegraphics[width=#2]{#1}\\[0.4cm]}{}}}%
     }
     ```
     - Replaced `\includegraphics` calls in title pages with `\@includelogoifexists`

   - **`apps/web/lib/latex/generate-tex.ts`** (line 56)
     - Added `generic: { university: "", institute: "" }` to `logoMap`

   - **`apps/web/components/project/compile-button.tsx`**
     - Added `onResult?: (r: CompileResult | null) => void` and `onError?: (e: string | null) => void` callback props
     - Added callback invocations wherever result/error state is set
     - Removed inline result/error JSX; simplified return to just button + queue badge
     - **LINT WARNINGS**: `result` (line 24) and `error` (line 25) state variables are now set but never read in JSX. `useEffect` (line 79) missing `onError` and `onResult` dependencies.

   - **`apps/web/components/project/ai-generate-button.tsx`**
     - Added `onError?: (e: string | null) => void` callback prop (destructured as `onErrorCallback`)
     - Forwarded background errors inline in `handleBackgroundGenerate()` and SSE errors via `useEffect`
     - Removed `{error && <p>...}` inline error display; changed wrapper from `<div className="space-y-3">` to `<>`
     - Removed combined `error` variable declaration
     - **LINT WARNING**: `bgError` (line 43) is assigned but never read (only forwarded via callback now)

   - **`apps/web/app/(dashboard)/projects/[id]/project-workspace.tsx`** (LOCKED file)
     - Added `CompileResultInfo` interface, `compileResult`/`compileError`/`generateError` state
     - Added auto-dismiss useEffect (8s timeout for compile success)
     - Added status message row ABOVE button row with click-to-dismiss
     - Passed `onResult={setCompileResult}`, `onError={setCompileError}` to CompileButton
     - Passed `onError={setGenerateError}` to AIGenerateButton
     - Added `X` icon import from lucide-react

   - **`.github/workflows/ci.yml`**
     - Changed `PNPM_VERSION` from `'9'` to `'10'`
     - Changed all `cache-dependency-path` from `apps/web/pnpm-lock.yaml` to `pnpm-lock.yaml`

   - **`pnpm-lock.yaml`**
     - Moved from `apps/web/pnpm-lock.yaml` to root (where pnpm workspace expects it)

   - **`apps/web/lib/ai/sanitise-latex.ts`** (line 35)
     - Fixed italic regex from `(?<!\*)\*([^*]+)\*(?!\*)` to `(?<![a-zA-Z*])\*([^*\n]+)\*(?!\*)`
     - Prevents matching `\section*` as italic delimiter and prevents cross-line matching

4. Errors and Fixes:
   - **CI `ERR_PNPM_NO_LOCKFILE`**: Lockfile was at `apps/web/pnpm-lock.yaml` (pre-workspace leftover) but pnpm workspace expects it at repo root. Fixed by running `pnpm install` at root to generate `pnpm-lock.yaml`, removing stale `apps/web/pnpm-lock.yaml` from git, updating CI `cache-dependency-path`, and bumping CI `PNPM_VERSION` from 9 to 10.
   - **Unit test `assemble.test.ts:711`**: The markdown italic regex in `sanitiseLatexOutput()` consumed `\section*{...}...\section*{...}` as a single italic span because `*` in `\section*` matched the italic opening delimiter and `[^*]+` matched across newlines to the next `*`. Fixed by adding `(?<![a-zA-Z*])` lookbehind and restricting capture to `[^*\n]+`.
   - **Lint warnings (CURRENT)**: After lifting messages out of button components, local state variables (`result`, `error` in compile-button; `bgError` in ai-generate-button) became unused for rendering. Also `useEffect` missing `onResult`/`onError` deps, and pre-existing unused `access` import in compile.ts.

5. Problem Solving:
   - All 6 post-deploy visual/functional issues implemented and verified via TypeScript check
   - CI pipeline fully repaired: lockfile location, pnpm version alignment, and pre-existing test regression all fixed
   - CI now passes all 4 jobs (Lint & Type Check, Unit Tests, Security & RLS Tests, Compile Test)
   - Remaining: lint warnings from the button layout refactor need cleanup

6. All User Messages:
   - "Implement the following plan: [6-change plan for logos, watermark, 3D axes, button layout, banner, word count]"
   - "commit, push and watch the CI"
   - "what is the cause of this onom ci failure and how to fix? will it cause any issues with the deployment?"
   - "I dont use coolify, its a hetner vps"
   - "yes" (to fixing the pre-existing test failure)
   - Final message with lint warnings asking to fix them, plus summary request

7. Pending Tasks:
   - Fix lint warnings in:
     - `ai-generate-button.tsx`: Remove unused `bgError` state (line 43)
     - `compile-button.tsx`: Remove unused `result` (line 24) and `error` (line 25) state variables; fix `useEffect` missing `onError`/`onResult` dependencies (line 79)
     - `compile.ts`: Remove unused `access` import (line 3)

8. Current Work:
   The user's final message contained lint warnings that need to be fixed. These are direct consequences of Change 6 (button layout refactoring) where we removed inline JSX for result/error display but left the corresponding state variables. The specific warnings:
   - `bgError` assigned but never used in `ai-generate-button.tsx:43`
   - `result` assigned but never used in `compile-button.tsx:24`
   - `error` assigned but never used in `compile-button.tsx:25`
   - Missing `onError`/`onResult` deps in useEffect at `compile-button.tsx:79`
   - `access` unused import in `compile.ts:3`

9. Optional Next Step:
   Fix the 5 lint warnings by:
   - Removing `bgError`/`setBgError` state from `ai-generate-button.tsx` (errors are now only forwarded via `onErrorCallback`)
   - Removing `result`/`setResult` and `error`/`setError` state from `compile-button.tsx` (forwarded via `onResult`/`onError` callbacks)
   - Adding `onError` and `onResult` to the useEffect dependency array in `compile-button.tsx` (or wrapping with eslint-disable if they're intentionally excluded to avoid re-renders)
   - Removing unused `access` import from `compile.ts` line 3
   - Then commit, push, and verify CI passes clean
</summary>_^~#]/g, " ")
         .replace(/\s+/g, " ")
         .trim();
       return stripped ? stripped.split(" ").length : 0;
     }
     ```

   - **`apps/web/components/project/licence-banner.tsx`** (lines 24-42)
     - Improved contrast: `bg-[#FDF6EE]`, `border-[#C8964C]/40`, heading `text-[#92600A]`, body `text-[#7A5F2A]`

   - **`apps/web/components/landing/hero-3d-scene.tsx`** (lines 343-401)
     - LOCKED file (user approved change). Replaced single `AXIS_LENGTH=2.2` with per-axis: `AXIS_LENGTH_X=1.8`, `AXIS_LENGTH_Y=2.2`, `AXIS_LENGTH_Z=1.2`. Updated tick loops, axis lines, and arrowheads.

   - **`apps/web/lib/latex/compile.ts`** (lines 264-294)
     - `injectWatermarkPackage()` rewritten: sandbox uses Palatino italic "Apollo" centered at scale 2.5; draft uses "Generated with Apollo" at scale 0.3. Both at angle 0.
     - **LINT WARNING**: `access` import on line 3 is unused (pre-existing, not from our changes)

   - **`templates/sskm-thesis.cls`** and **`templates/ssuhs-thesis.cls`**
     - Added `\@includelogoifexists` helper after logo setter commands:
     ```latex
     \newcommand{\@includelogoifexists}[2]{%
       \IfFileExists{#1.pdf}{\includegraphics[width=#2]{#1}\\[0.4cm]}{%
       \IfFileExists{#1.png}{\includegraphics[width=#2]{#1}\\[0.4cm]}{%
       \IfFileExists{#1.jpg}{\includegraphics[width=#2]{#1}\\[0.4cm]}{}}}%
     }
     ```
     - Replaced `\includegraphics` calls in title pages with `\@includelogoifexists`

   - **`apps/web/lib/latex/generate-tex.ts`** (line 56)
     - Added `generic: { university: "", institute: "" }` to `logoMap`

   - **`apps/web/components/project/compile-button.tsx`**
     - Added `onResult?: (r: CompileResult | null) => void` and `onError?: (e: string | null) => void` callback props
     - Added callback invocations wherever result/error state is set
     - Removed inline result/error JSX; simplified return to just button + queue badge
     - **LINT WARNINGS**: `result` (line 24) and `error` (line 25) state variables are now set but never read in JSX. `useEffect` (line 79) missing `onError` and `onResult` dependencies.

   - **`apps/web/components/project/ai-generate-button.tsx`**
     - Added `onError?: (e: string | null) => void` callback prop (destructured as `onErrorCallback`)
     - Forwarded background errors inline in `handleBackgroundGenerate()` and SSE errors via `useEffect`
     - Removed `{error && <p>...}` inline error display; changed wrapper from `<div className="space-y-3">` to `<>`
     - Removed combined `error` variable declaration
     - **LINT WARNING**: `bgError` (line 43) is assigned but never read (only forwarded via callback now)

   - **`apps/web/app/(dashboard)/projects/[id]/project-workspace.tsx`** (LOCKED file)
     - Added `CompileResultInfo` interface, `compileResult`/`compileError`/`generateError` state
     - Added auto-dismiss useEffect (8s timeout for compile success)
     - Added status message row ABOVE button row with click-to-dismiss
     - Passed `onResult={setCompileResult}`, `onError={setCompileError}` to CompileButton
     - Passed `onError={setGenerateError}` to AIGenerateButton
     - Added `X` icon import from lucide-react

   - **`.github/workflows/ci.yml`**
     - Changed `PNPM_VERSION` from `'9'` to `'10'`
     - Changed all `cache-dependency-path` from `apps/web/pnpm-lock.yaml` to `pnpm-lock.yaml`

   - **`pnpm-lock.yaml`**
     - Moved from `apps/web/pnpm-lock.yaml` to root (where pnpm workspace expects it)

   - **`apps/web/lib/ai/sanitise-latex.ts`** (line 35)
     - Fixed italic regex from `(?<!\*)\*([^*]+)\*(?!\*)` to `(?<![a-zA-Z*])\*([^*\n]+)\*(?!\*)`
     - Prevents matching `\section*` as italic delimiter and prevents cross-line matching

4. Errors and Fixes:
   - **CI `ERR_PNPM_NO_LOCKFILE`**: Lockfile was at `apps/web/pnpm-lock.yaml` (pre-workspace leftover) but pnpm workspace expects it at repo root. Fixed by running `pnpm install` at root to generate `pnpm-lock.yaml`, removing stale `apps/web/pnpm-lock.yaml` from git, updating CI `cache-dependency-path`, and bumping CI `PNPM_VERSION` from 9 to 10.
   - **Unit test `assemble.test.ts:711`**: The markdown italic regex in `sanitiseLatexOutput()` consumed `\section*{...}...\section*{...}` as a single italic span because `*` in `\section*` matched the italic opening delimiter and `[^*]+` matched across newlines to the next `*`. Fixed by adding `(?<![a-zA-Z*])` lookbehind and restricting capture to `[^*\n]+`.
   - **Lint warnings (CURRENT)**: After lifting messages out of button components, local state variables (`result`, `error` in compile-button; `bgError` in ai-generate-button) became unused for rendering. Also `useEffect` missing `onResult`/`onError` deps, and pre-existing unused `access` import in compile.ts.

5. Problem Solving:
   - All 6 post-deploy visual/functional issues implemented and verified via TypeScript check
   - CI pipeline fully repaired: lockfile location, pnpm version alignment, and pre-existing test regression all fixed
   - CI now passes all 4 jobs (Lint & Type Check, Unit Tests, Security & RLS Tests, Compile Test)
   - Remaining: lint warnings from the button layout refactor need cleanup

6. All User Messages:
   - "Implement the following plan: [6-change plan for logos, watermark, 3D axes, button layout, banner, word count]"
   - "commit, push and watch the CI"
   - "what is the cause of this onom ci failure and how to fix? will it cause any issues with the deployment?"
   - "I dont use coolify, its a hetner vps"
   - "yes" (to fixing the pre-existing test failure)
   - Final message with lint warnings asking to fix them, plus summary request

7. Pending Tasks:
   - Fix lint warnings in:
     - `ai-generate-button.tsx`: Remove unused `bgError` state (line 43)
     - `compile-button.tsx`: Remove unused `result` (line 24) and `error` (line 25) state variables; fix `useEffect` missing `onError`/`onResult` dependencies (line 79)
     - `compile.ts`: Remove unused `access` import (line 3)

8. Current Work:
   The user's final message contained lint warnings that need to be fixed. These are direct consequences of Change 6 (button layout refactoring) where we removed inline JSX for result/error display but left the corresponding state variables. The specific warnings:
   - `bgError` assigned but never used in `ai-generate-button.tsx:43`
   - `result` assigned but never used in `compile-button.tsx:24`
   - `error` assigned but never used in `compile-button.tsx:25`
   - Missing `onError`/`onResult` deps in useEffect at `compile-button.tsx:79`
   - `access` unused import in `compile.ts:3`

9. Optional Next Step:
   Fix the 5 lint warnings by:
   - Removing `bgError`/`setBgError` state from `ai-generate-button.tsx` (errors are now only forwarded via `onErrorCallback`)
   - Removing `result`/`setResult` and `error`/`setError` state from `compile-button.tsx` (forwarded via `onResult`/`onError` callbacks)
   - Adding `onError` and `onResult` to the useEffect dependency array in `compile-button.tsx` (or wrapping with eslint-disable if they're intentionally excluded to avoid re-renders)
   - Removing unused `access` import from `compile.ts` line 3
   - Then commit, push, and verify CI passes clean

If you need specific details from before compaction (like exact code snippets, error messages, or content you generated), read the full transcript at: /Users/devs/.REDACTED.jsonl
Please continue the conversation from where we left off without asking the user any further questions. Continue with the last task that you were asked to work on.

---

Also the copiled pdf still says Draft-Sandbox as watermark. And the word count still shows red with 5400/1500 counts.

---

fix the draft footer issue as well

---

commit and push, watch ci